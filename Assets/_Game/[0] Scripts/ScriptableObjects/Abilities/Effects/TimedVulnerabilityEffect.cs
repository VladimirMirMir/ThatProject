using UnityEngine;
using System.Collections.Generic;

[CreateAssetMenu(fileName = "New Timed Vulnerability Effect", menuName = "ScriptableObject/Ability Effects/Timed Vulnerability Effect")]
public class TimedVulnerabilityEffect : AbilityEffect
{
    public DamageType type;
    public GameEvent trigger;
    public int duration;

    public override void Affect()
    {
        var go = new GameObject("TimedVulnerabilityEffect");
        var timedEffect = go.AddComponent<TimedEffect>();
        timedEffect.Init(
            duration, 
            targetting.GetTargets(), 
            trigger, 
            (List<ITargetable> targets) => { },
            (List<ITargetable> targets) =>
            {
                foreach (var target in targets)
                    if (target is Creature creature)
                        creature.ToggleVulnerabilityTo(type, true);
            }, 
            (List<ITargetable> targets) => 
            {
                foreach (var target in targets)
                    if (target is Creature creature)
                        creature.ToggleVulnerabilityTo(type, false);
            });
    }
}